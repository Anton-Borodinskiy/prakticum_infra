deploy-backend:
  stage: deploy
  before_script:
    - apk add openssh-client bash
    - eval $(ssh-agent -s)
    - echo "$SSH_PRIVATE_KEY" | tr -d '\r' | ssh-add -
    - mkdir -p ~/.ssh
    - chmod 700 ~/.ssh
    - echo "$SSH_KNOWN_HOSTS" >> ~/.ssh/known_hosts
    - chmod 644 ~/.ssh/known_hosts
  script:
    - scp -rp ./kubernetes/* ${DEV_USER}@${DEV_HOST}:/home/${DEV_USER}/kubernetes
    - ssh ${DEV_USER}@${DEV_HOST}
      "export "kubeconfig='${kubeconfig}";
      /bin/bash -s " < ./kubernetes/deploy.sh


